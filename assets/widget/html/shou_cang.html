<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <title>收藏</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" href="../css/aui.css">
    <script src="../script/jquery.js"></script>
    <style>
        .aui-row {
            width: 95%;
        }
        .aui-grid [class*=aui-col-]{
            padding: 0.3rem 0;
        }
        .k-row i {
            float: left;
            width: 20px;
        }
    </style>
</head>
<body class="qiushi-frame">
<div style="overflow-x: scroll;">
    <ul class="aui-list aui-list-in" id="content">

    </ul>
</div>
</body>
<script type="text/javascript" src="../script/api.js"></script>
<script>
    var db = null;
    apiready = function () {
        api.addEventListener({
            name: 'keyback'
        }, function (ret, err) {
            return false;
        });
        window.ApiUtil = api.require('ApiUtil');
        db = api.require('db');
        api.setRefreshHeaderInfo({
            visible: true,
            //loadingImg: 'widget://image/refresh.png',
            bgColor: '#ccc',
            textColor: '#fff',
            textDown: '下拉刷新...',
            textUp: '松开刷新...',
            showTime: true
        }, function (ret, err) {
            console.log(JSON.stringify(ret));
            console.log(JSON.stringify(err));
            init();
            setTimeout(function () {
                api.refreshHeaderLoadDone();
            },2000);
        });
        init();
    };
    function get_xing_qi(obj) {
        var w = "日一二三四五六".charAt(new Date(obj).getDay());
        return w;
    }
    function openDB(callback) {
        db.openDatabase({
            name: 'contact'
        }, function (ret, err) {
            if (ret.status) {
                db.isOpen = true;
                ApiUtil.log({tag: 'openDatabase', message: ret});
                callback(true);
            } else {
                ApiUtil.log({tag: 'openDatabase', message: err});
                db.isOpen = false;
                callback(false);
            }
        });
    }
    function selectDB(sql, callback) {
        db.selectSql({
            name: 'contact',
            sql: sql
        }, function (ret, err) {
            if (ret.status) {
                //alert(JSON.stringify(ret));
                callback(true, ret);
            } else {
                //alert(JSON.stringify(err));
                callback(false, err);
            }
        });
    }
    function init() {
        $('#content').html('');
        var sql = 'select name,sex,birthday,address,phone,qq,wechar,relation,love,job,shift,speciality,level,subDate,subTime,subAddress,subEvent,subContent,isCollect,isRemind from contacts where isCollect = "1"';
        openDB(function (ret) {
            setTimeout(function () {
                if (ret) {
                    selectDB(sql, function (ret, res) {
                        console.log(JSON.stringify(res));
                        if (ret && res.status) {
                            var li =
                                '<li class="aui-list-item" style="margin-bottom: 25px;">' +
                                '    <div class="aui-row">' +
                                '        <div class="k-row" style="text-align: center;line-height: 4em;">' +
                                '            暂无数据，快去添加吧' +
                                '        </div>' +
                                '    </div>' +
                                '</li>';
                            if (res.data.length > 0) {
                                for (var i = 0; i < res.data.length; i++) {
                                    var user = res.data[i];
                                    li =
                                        '<li class="aui-list-item" style="margin-bottom: 25px;">' +
                                        '    <div class="aui-row">' +
                                        '        <div class="k-row">' +
                                        '            <i class="aui-iconfont aui-icon-my"></i>'+
                                        '            <i class="aui-iconfont aui-icon-star" style="float: right;font-size: 30px;margin-right: 20px;color: rgba(8, 148, 236, 0.99);;"></i>' +
                                        '            <div>' + user.name + '</div>' +
                                        '        </div>' +
                                        '        <div class="k-row">' +
                                        '            <div>' + user.phone + '</div>' +
                                        '        </div>' +
                                        '        <div class="k-row">' +
                                        '            <div>' + user.subDate + '&nbsp;&nbsp;&nbsp;' + user.subTime + '&nbsp;&nbsp;&nbsp;星期' + get_xing_qi(user.subDate) + '</div>' +
                                        '        </div>' +
                                        '        <div class="k-row">' +
                                        '            <div>' + user.subEvent + '</div>' +
                                        '        </div>' +
                                        '        <div class="k-row">' +
                                        '            <div>' + user.subAddress + '</div>' +
                                        '        </div>' +
                                        '        <div class="k-row">' +
                                        '            <div>' + user.subContent + '</div>' +
                                        '        </div>' +
                                        '    </div>' +
                                        '</li>';
                                    $('#content').append(li);
                                }
                            } else {
                                $('#content').append(li);
                            }
                        }
                    })
                }
            }, 1000);
        });
    }
</script>
</html>
